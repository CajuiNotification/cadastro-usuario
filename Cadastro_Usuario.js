const db=firebase.firestore(),uid=localStorage.getItem("Uid");var nomeSession;firebase.storage().ref().child("vazio").child("personIcon.jpg").getDownloadURL().then(a=>{const b=document.getElementById("imgPhotoCad");b.setAttribute("src",a)}).catch(a=>{alert(a.message)});try{class a{constructor(a,b,c,d){this.nome=a,this.email=b,this.senha=c,this.perfil=d}cadastrar(){document.querySelector("div[class='container-loader']").style.display="block",firebase.auth().createUserWithEmailAndPassword(this.email,this.senha).then(a=>{db.collection("usuarios(Site)").add({uid:a.user.uid,nome:this.nome,email:this.email,senha:this.senha}).then(a=>{const b=a.id;document.querySelector("div[class='container-loader']").style.display="none",db.collection("usuarios(Site)").doc(b).collection("perfis").add({idUsuario:b,perfil:this.perfil}).then(()=>{const a=new Date,b=(a.getDate()+"").padStart(2,"0"),c=(a.getMonth()+1+"").padStart(2,"0"),d=a.getFullYear()+"";var e=a.getHours()+"";0==e&&(e=a.getHours()+""+"0");var f=a.getMinutes()+"";f=10>f?(a.getMinutes()+"").padStart(2,"0"):a.getMinutes()+"";const g=`${b}/${c}/${d} as ${e}:${f}`;db.collection("historico").add({usuarioUID:uid,alteracao:`O usuario ${nomeSession} cadastrou o usuario "${this.nome}" no dia ${g}`,data_hora:g}).then(()=>{alert("Usuario cadastrado")}).catch(a=>{document.querySelector("div[class='container-loader']").style.display="none",alert(a.message)})}).catch(a=>{document.querySelector("div[class='container-loader']").style.display="none",alert(a.message)})}).catch(a=>{document.querySelector("div[class='container-loader']").style.display="none",alert(a.message)})}).catch(a=>{document.querySelector("div[class='container-loader']").style.display="none","auth/email-already-in-use"==a.code?alert("Email existente"):"auth/invalid-email"==a.code?alert("Email invalido"):alert(a.message)})}}db.collection("perfis").get().then(a=>{const b=document.querySelector("select[name=\"perfis\"]");if(0==a.docs.length){b.innerHTML+="<option>Nenhum perfil cadastrado :/</option>"}else{const c=a.docs.reduce((a,b)=>(a+=`<option>${b.data().descricao}</option>`,a),"");b.innerHTML+=c}}).catch(a=>{alert(a.message)});const b=document.getElementById("imgPhotoCad"),c=document.querySelector("input[name=\"imagem\"]");b.addEventListener("click",function(){c.click(),c.addEventListener("change",()=>{let a=new FileReader;a.onload=()=>{b.src=a.result},a.readAsDataURL(c.files[0])})}),document.querySelector("button").addEventListener("click",function(){const b=new FormData(document.querySelector("form")),c=b.get("nome").trim(),d=b.get("email").replace(/ /g,""),e=b.get("senha").replace(/ /g,""),f=b.get("perfis"),g=b.get("imagem");0==c.length||0==e.length||0==d.length?alert("Preencha todos os campos"):6>e.length?alert("senha invalida"):db.collection("usuarios").where("nome","==",c).get().then(b=>{if(0<b.docs.length)alert("Nome de usuario existente");else if(0<g.size){const b=g.name.toLowerCase().split(".").pop();"jpg"!=b&&"png"!=b?alert("Extens\xE3o de imagem n\xE3o aceita"):firebase.storage().ref().child(c).put(g).then(()=>{var b=new a(c,d,e,f);b.cadastrar()}).catch(a=>{alert(a.message)})}else{var h=new a(c,d,e,f);h.cadastrar()}}).catch(a=>{alert(a.message)})})}catch(a){alert("Erro "+a)}